import{r as h,o as f,c as p,g as u,a as _,w as l,b as d,F as y,l as N,t as v,e as k,f as x,q as O,Q as P,T as F,s as B,u as H,x as I,y as a,z,O as E,d as L,A as G}from"./app-B3zO_ILq.js";import{L as U}from"./index-D6YI7NWh.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./focus-management-C4nM2lYB.js";import"./keyboard-DTUPi9Wy.js";import"./disposables-BnUz9YMx.js";import"./description-BoEneSfX.js";const Q={props:{referral:{required:!0}}},W={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},J={class:"grid gap-2"};function K(r,s,n,i,w,e){const b=h("v-heading"),c=h("v-badge"),Z=h("v-form-error"),R=h("v-paragraph");return n.referral&&n.referral.data?(f(),p("div",W,[u("div",null,[_(b,{size:6,class:"font-medium"},{default:l(()=>[d("Referral Reasons")]),_:1}),u("div",J,[(f(!0),p(y,null,N(n.referral.data.referral_reasons.map(q=>q.name),(q,t)=>(f(),p("div",{key:"referralReason_"+t},[_(c,null,{default:l(()=>[d(v(q),1)]),_:2},1024)]))),128))])]),u("div",null,[_(b,{size:6,class:"font-medium"},{default:l(()=>[d("Procedure")]),_:1}),n.referral.data.procedure?(f(),k(c,{key:0},{default:l(()=>[d(v(n.referral.data.procedure.name),1)]),_:1})):(f(),k(Z,{key:1},{default:l(()=>[d("No procedure selected.")]),_:1}))]),u("div",null,[_(b,{size:6,class:"font-medium"},{default:l(()=>[d("Notes")]),_:1}),n.referral.data.notes?(f(),k(R,{key:0},{default:l(()=>[d(v(n.referral.data.notes),1)]),_:1})):(f(),k(Z,{key:1},{default:l(()=>[d("No notes available.")]),_:1}))])])):x("",!0)}const X=S(Q,[["render",K]]),Y={props:{referral:{required:!0}},computed:{address(){return[this.referral.data.patient_user.address_line_1,this.referral.data.patient_user.address_line_2,this.referral.data.patient_user.city,this.referral.data.patient_user.state.name,this.referral.data.patient_user.zip_code].filter(r=>typeof r=="string"&&r.length).reduce((r,s)=>`${r}, ${s}`)}}},$={key:0},T={class:"flex items-center gap-2 italic"},ee=u("div",{class:"w-1 h-1 rounded-full bg-gray-500"},null,-1);function re(r,s,n,i,w,e){const b=h("v-heading"),c=h("v-paragraph");return n.referral&&n.referral.data?(f(),p("div",$,[_(b,{size:6,class:"font-medium"},{default:l(()=>[d(v(n.referral.data.patient_user.name),1)]),_:1}),u("div",T,[_(c,null,{default:l(()=>[d(v(n.referral.data.patient_user.email),1)]),_:1}),n.referral.data.patient_user.phone_number?(f(),p(y,{key:0},[ee,_(c,null,{default:l(()=>[d(v(n.referral.data.patient_user.phone_number),1)]),_:1})],64)):x("",!0)]),_(c,{class:"italic"},{default:l(()=>[d(v(e.address),1)]),_:1})])):x("",!0)}const te=S(Y,[["render",re]]),ae={props:{referral:{required:!0}},computed:{address(){return[this.referral.data.recipient_user.address_line_1,this.referral.data.recipient_user.address_line_2,this.referral.data.recipient_user.city,this.referral.data.recipient_user.state.name,this.referral.data.recipient_user.zip_code].filter(r=>typeof r=="string"&&r.length).reduce((r,s)=>`${r}, ${s}`)}}},ie={key:0},le={class:"flex items-center gap-2 italic"},de=u("div",{class:"w-1 h-1 rounded-full bg-gray-500"},null,-1);function ne(r,s,n,i,w,e){const b=h("v-heading"),c=h("v-paragraph");return n.referral&&n.referral.data?(f(),p("div",ie,[_(b,{size:6,class:"font-medium"},{default:l(()=>[d(v(n.referral.data.recipient_user.name),1)]),_:1}),u("div",le,[_(c,null,{default:l(()=>[d(v(n.referral.data.recipient_user.email),1)]),_:1}),n.referral.data.recipient_user.phone_number?(f(),p(y,{key:0},[de,_(c,null,{default:l(()=>[d(v(n.referral.data.recipient_user.phone_number),1)]),_:1})],64)):x("",!0)]),_(c,{class:"italic"},{default:l(()=>[d(v(e.address),1)]),_:1})])):x("",!0)}const se=S(ae,[["render",ne]]),oe={name:"ReferralsCreateEdit",layout:U,props:{documentCategories:{type:Object,required:!1},patients:{type:Object,required:!0},procedures:{type:Object,required:!0},recipients:{type:Object,required:!0},referralReasons:{type:Object,required:!0},referral:{type:Object,required:!1,default:()=>{}},states:{type:Object,required:!0}},setup(r){const s=O("auth"),n=O("alert"),i=O("toast"),w=P(),e=F({_method:"post",referral_status_id:2,referral_date:new Date().toISOString().split("T")[0],state_id:w.props.auth.user.state_id||w.props.query.state_id,procedure_id:"",referral_reason_ids:[],notes:"",patient_create:!r.patients.data||!r.patients.data.length||!1,patient_user_id:"",patient_name:"",patient_email:"",patient_phone_number:"",patient_height:"",patient_weight:"",patient_gender:"",patient_birthdate:"",patient_address_line_1:"",patient_address_line_2:"",patient_city:"",patient_state_id:"",patient_zip_code:"",recipient_user_id:"",documents:{}}),b=B({});r.referral&&r.referral.data&&(e._method="patch",e.referral_status_id=r.referral.data.referral_status_id,e.referral_date=new Date(r.referral.data.referral_date).toISOString().split("T")[0],e.state_id=r.referral.data.state_id,e.procedure_id=r.referral.data.procedure_id,e.referral_reason_ids=r.referral.data.referral_reasons.map(({referral_reason_id:t})=>t),e.notes=r.referral.data.notes,e.patient_user_id=r.referral.data.patient_user_id,e.recipient_user_id=r.referral.data.recipient_user_id,r.referral.data.documents.forEach(t=>{b[t.document_type_id]=t})),(!r.referral||!r.referral.data)&&H(()=>e.state_id,t=>{if(!t)return;const o={...w.props.query,state_id:t||void 0};E.visit(route(route().current()),{method:"get",data:o,preserveState:!0,preserveScroll:!0,replace:!0}),e.patient_user_id="",e.recipient_user_id=""},{immediate:!0});const c=I([{title:"General Information",fields:[{type:"date",label:"Referral Date",model:a({get:()=>e.referral_date,set:t=>e.referral_date=t}),required:!0,attributes:a(()=>({disabled:e.processing||r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1}))},{type:"select",label:"Referral State",model:a({get:()=>e.state_id,set:t=>e.state_id=t}),options:[{label:"Select State",value:""},...r.states.data.map(({name:t,state_id:o})=>({label:t,value:o}))],required:!0,attributes:a(()=>({disabled:e.processing||r.referral&&r.referral.data}))},{type:"select",label:"Procedure (CPT)",model:a({get:()=>e.procedure_id,set:t=>e.procedure_id=t}),options:[{label:"Select Procedure",value:""},...r.procedures.data.map(({name:t,procedure_id:o})=>({label:t,value:o}))],required:!0,visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1))},{type:"select",label:"Referral Reasons (ICD)",model:a({get:()=>e.referral_reason_ids,set:t=>e.referral_reason_ids=t}),options:[{label:"Select Reasons",value:""},...r.referralReasons.data.map(({name:t,referral_reason_id:o})=>({label:t,value:o}))],required:!0,attributes:{multiple:!0},visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1)),class:"w-full max-w-prose col-span-full"},{type:"textarea",label:"Other Notes",model:a({get:()=>e.notes,set:t=>e.notes=t}),required:!1,class:"w-full col-span-full",attributes:a(()=>({placeholder:"Enter additional notes for the referral.",disabled:e.processing})),visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1))},{type:"component",component:z(X),bind:{referral:r.referral},visible:a(()=>r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1)}]},{title:"Patient Information",fields:[{type:"toggle",label:"Options",toggleLabel:"Create New Patient",model:a({get:()=>e.patient_create,set:t=>e.patient_create=t}),required:!1,error:a(()=>e.errors.patient_create),visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1))},{type:"select",label:"Select Patient",model:a({get:()=>e.patient_user_id,set:t=>e.patient_user_id=t}),options:a(()=>r.patients.data.map(({name:t,user_id:o,email:g})=>({label:t,value:o,description:g}))),required:!0,error:a(()=>e.errors.patient_user_id),visible:a(()=>!e.patient_create&&(!r.referral||!r.referral.data))},{type:"divider",visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1))},{type:"text",label:"Name",model:a({get:()=>e.patient_name,set:t=>e.patient_name=t}),required:!0,error:a(()=>e.errors.patient_name),visible:a(()=>!!e.patient_create)},{type:"email",label:"Email",model:a({get:()=>e.patient_email,set:t=>e.patient_email=t}),required:!0,error:a(()=>e.errors.patient_email),visible:a(()=>!!e.patient_create)},{type:"text",label:"Phone Number",model:a({get:()=>e.patient_phone_number,set:t=>e.patient_phone_number=t}),required:!1,error:a(()=>e.errors.patient_phone_number),visible:a(()=>!!e.patient_create)},{type:"text",label:"Height",model:a({get:()=>e.patient_height,set:t=>e.patient_height=t}),required:!1,error:a(()=>e.errors.patient_height),visible:a(()=>!!e.patient_create)},{type:"text",label:"Weight",model:a({get:()=>e.patient_weight,set:t=>e.patient_weight=t}),required:!1,error:a(()=>e.errors.patient_weight),visible:a(()=>!!e.patient_create)},{type:"text",label:"Gender",model:a({get:()=>e.patient_gender,set:t=>e.patient_gender=t}),required:!1,error:a(()=>e.errors.patient_gender),visible:a(()=>!!e.patient_create)},{type:"text",label:"Address Line 1",model:a({get:()=>e.patient_address_line_1,set:t=>e.patient_address_line_1=t}),required:!1,error:a(()=>e.errors.patient_address_line_1),visible:a(()=>!!e.patient_create)},{type:"text",label:"Address Line 2",model:a({get:()=>e.patient_address_line_2,set:t=>e.patient_address_line_2=t}),required:!1,error:a(()=>e.errors.patient_address_line_2),visible:a(()=>!!e.patient_create)},{type:"text",label:"City",model:a({get:()=>e.patient_city,set:t=>e.patient_city=t}),required:!1,error:a(()=>e.errors.patient_city),visible:a(()=>!!e.patient_create)},{type:"select",label:"State",model:a({get:()=>e.patient_state_id,set:t=>e.patient_state_id=t}),options:[{label:"Select State",value:""},...r.states.data.map(({name:t,state_id:o})=>({label:t,value:o}))],required:!0,error:a(()=>e.errors.patient_state_id),visible:a(()=>!!e.patient_create)},{type:"text",label:"Zip Code",model:a({get:()=>e.patient_zip_code,set:t=>e.patient_zip_code=t}),required:!1,error:a(()=>e.errors.patient_zip_code),visible:a(()=>!!e.patient_create)},{type:"date",label:"Birthdate",model:a({get:()=>e.patient_birthdate,set:t=>e.patient_birthdate=t}),required:!1,error:a(()=>e.errors.patient_birthdate),visible:a(()=>!!e.patient_create)},{type:"component",component:z(te),bind:{referral:r.referral},visible:a(()=>r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1)}]},{title:"Recipient Information",fields:[{type:"radio-card-array",model:a({get:()=>e.recipient_user_id,set:t=>e.recipient_user_id=t}),options:a(()=>r.recipients.data.map(({name:t,user_id:o,email:g})=>({label:t,value:o,description:g}))),required:!0,error:a(()=>e.errors.recipient_user_id),class:"w-full col-span-full",visible:a(()=>!(r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1))},{type:"component",component:z(se),bind:{referral:r.referral},visible:a(()=>r.referral&&r.referral.data&&r.referral.data.referral_status_id!=1)}]},{title:"Document Information",fields:r.documentCategories.data.filter(t=>Object.keys(t.document_types.filter(o=>s().can([`document-type.${o.document_type_id}.show`]))).length).flatMap((t,o)=>{const g=t.document_types;return[function(){return o>0?{type:"divider"}:{}}(),{type:"heading",label:t.name},...g.filter(m=>s().can([`document-type.${m.document_type_id}.show`])).map(m=>({type:"file",label:m.name,model:a({get:()=>e.documents[m.document_type_id],set:M=>e.documents[m.document_type_id]=M}),modelCurrent:a(()=>b[m.document_type_id]),file:{showFile:M=>route("panel.documents.download",{document:M.modelCurrent.document_id,_t:Date.now()}),destroyFile:M=>{n().confirm(()=>new Promise((j,D)=>{e.delete(route("panel.documents.destroy",{document:M.modelCurrent.document_id}),{onSuccess:()=>{i().success("Document deleted successfully!"),e.documents[m.document_type_id]=null,b[m.document_type_id]=null,E.reload({}),j()},onError:C=>{Object.keys(C).forEach(V=>{const A=C[V];i().error(A)}),D(C)}})}))}},attributes:a(()=>({disabled:e.processing||!s().can([`document-type.${m.document_type_id}.store`])&&s().can([`document-type.${m.document_type_id}.update`])})),error:a(()=>e.errors[`documents.${m.document_type_id}`]),permissions:{can_list:s().can([`document-type.${m.document_type_id}.list`]),can_show:s().can([`document-type.${m.document_type_id}.show`]),can_store:s().can([`document-type.${m.document_type_id}.store`]),can_update:s().can([`document-type.${m.document_type_id}.update`]),can_delete:s().can([`document-type.${m.document_type_id}.delete`])}}))].filter(m=>m.type)})}]),Z=()=>{e.post(route("panel.referrals.store"),{preserveState:!1,onSuccess:()=>i().success("Referral created successfully!"),onError:t=>{Object.keys(t).forEach(o=>{const g=t[o];i().error(g)})}})},R=()=>{e.post(route("panel.referrals.update",{referral:r.referral.data.referral_id}),{preserveState:!1,onSuccess:()=>i().success("Referral updated successfully!"),onError:t=>{Object.keys(t).forEach(o=>{const g=t[o];i().error(g)})}})},q=()=>{e.clearErrors(),!(!r.referral||!r.referral.data||!r.referral.data.referral_id)?R():Z()};return{form:e,fieldGroups:c,referral:r.referral,submitForm:q}}},_e={class:"flex items-center justify-between gap-2"},fe=u("div",{class:"flex gap-2"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[u("path",{d:"M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"}),u("path",{"fill-rule":"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z","clip-rule":"evenodd"})]),d(" View Appointment ")],-1),ce=u("div",{class:"flex gap-2"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[u("path",{d:"M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"}),u("path",{"fill-rule":"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z","clip-rule":"evenodd"})]),d(" Create Appointment ")],-1),ue=u("div",{class:"flex gap-2"},[u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[u("path",{"fill-rule":"evenodd",d:"M10.5 3.75a6 6 0 0 0-5.98 6.496A5.25 5.25 0 0 0 6.75 20.25H18a4.5 4.5 0 0 0 2.206-8.423 3.75 3.75 0 0 0-4.133-4.303A6.001 6.001 0 0 0 10.5 3.75Zm2.25 6a.75.75 0 0 0-1.5 0v4.94l-1.72-1.72a.75.75 0 0 0-1.06 1.06l3 3a.75.75 0 0 0 1.06 0l3-3a.75.75 0 1 0-1.06-1.06l-1.72 1.72V9.75Z","clip-rule":"evenodd"})]),d(" Summary ")],-1),me=["value"];function pe(r,s,n,i,w,e){const b=h("v-inertia-head"),c=h("v-button"),Z=h("v-section-heading"),R=h("v-content-body"),q=h("v-app-form-builder"),t=h("v-form-group"),o=h("v-form");return f(),p("div",null,[_(b,{title:i.referral&&i.referral.data&&i.referral.data.referral_id?"Edit Referral":"Create Referral"},null,8,["title"]),_(R,null,{default:l(()=>[_(Z,null,G({title:l(()=>[i.referral&&i.referral.data&&i.referral.data.referral_id?(f(),p(y,{key:0},[d(" Edit Referral ")],64)):(f(),p(y,{key:1},[d(" Create Referral ")],64))]),_:2},[i.referral&&i.referral.data&&i.referral.data.referral_id?{name:"actions",fn:l(()=>[u("div",_e,[i.referral.data.appointment_id?(f(),k(c,{key:0,href:r.route("panel.appointments.show",{appointment:i.referral.data.appointment_id}),color:"white",size:"sm"},{default:l(()=>[fe]),_:1},8,["href"])):(f(),k(c,{key:1,href:r.route("panel.appointments.create",{referral_id:i.referral.data.referral_id}),color:"white",size:"sm"},{default:l(()=>[ce]),_:1},8,["href"])),_(c,{href:r.route("panel.referrals.documents.summary",{referral:i.referral.data.referral_id}),target:"_blank",anchor:!0,color:"white",size:"sm"},{default:l(()=>[ue]),_:1},8,["href"])])]),key:"0"}:void 0]),1024)]),_:1}),_(o,{onSubmit:L(i.submitForm,["prevent"])},{default:l(()=>[_(q,{"field-groups":i.fieldGroups},null,8,["field-groups"]),_(t,{class:"col-span-full flex items-center justify-end gap-2 text-right border-t border-gray-200 px-6 py-4"},{default:l(()=>[i.form.progress?(f(),p("progress",{key:0,value:i.form.progress.percentage,max:"100"},v(i.form.progress.percentage)+"% ",9,me)):x("",!0),_(c,{href:r.route("panel.referrals.index"),color:"white",disabled:i.form.processing},{default:l(()=>[d(" Cancel ")]),_:1},8,["href","disabled"]),i.referral&&i.referral.data?(f(),p(y,{key:1},[i.referral.data.referral_status_id==1?(f(),k(c,{key:0,type:"submit",color:"white",disabled:i.form.processing},{default:l(()=>[d(" Update Draft ")]),_:1},8,["disabled"])):x("",!0),_(c,{type:"submit",color:"primary",disabled:i.form.processing,onClick:s[0]||(s[0]=g=>i.form.referral_status_id=2)},{default:l(()=>[i.referral.data.referral_status_id==1?(f(),p(y,{key:0},[d(" Send Referral ")],64)):(f(),p(y,{key:1},[d(" Update Referral ")],64))]),_:1},8,["disabled"])],64)):(f(),p(y,{key:2},[_(c,{type:"submit",color:"white",disabled:i.form.processing,onClick:s[1]||(s[1]=g=>i.form.referral_status_id=1)},{default:l(()=>[d(" Save Draft ")]),_:1},8,["disabled"]),_(c,{type:"submit",color:"primary",disabled:i.form.processing,onClick:s[2]||(s[2]=g=>i.form.referral_status_id=2)},{default:l(()=>[d(" Send Referral ")]),_:1},8,["disabled"])],64))]),_:1})]),_:1},8,["onSubmit"])])}const ke=S(oe,[["render",pe]]);export{ke as default};
